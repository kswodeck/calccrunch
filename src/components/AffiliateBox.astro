---
import affiliatesData from '../data/affiliates.json';

const { 
  category = 'financial',
  title = 'Ready to Take Action?',
  description = 'Check out these trusted partners to help you move forward'
} = Astro.props;

// Map calculator categories to affiliate categories
const affiliateCategoryMap = {
  'financial': 'financial',
  'health-fitness': 'health',
  'home-real-estate': 'home',
  'automotive': 'default',
  'food-cooking': 'default',
  'education': 'default',
  'business-sales': 'default',
  'time-date': 'default',
  'math-conversions': 'default',
  'miscellaneous': 'default'
};

const affiliateCategory = affiliateCategoryMap[category] || 'default';

// Get affiliates for category, sorted by priority
const affiliates = (affiliatesData.affiliates[affiliateCategory] || affiliatesData.affiliates.default)
  .filter(aff => aff.active)
  .sort((a, b) => a.priority - b.priority)
  .slice(0, 3); // Show top 3
---

{affiliates.length > 0 && (
  <div class="affiliate-box">
    <div class="affiliate-header">
      <h3>{title}</h3>
      <p>{description}</p>
    </div>
    
    <div class="affiliate-grid">
      {affiliates.map(affiliate => (
        <a 
          href={affiliate.link} 
          class="affiliate-card"
          target="_blank"
          rel="noopener noreferrer sponsored"
        >
          {affiliate.badge && (
            <div class="affiliate-badge">{affiliate.badge}</div>
          )}
          
          <div class="affiliate-logo">
            <img 
              src={affiliate.logo} 
              alt={`${affiliate.company} logo`}
              width="120"
              height="40"
              loading="lazy"
            />
          </div>
          
          <h4>{affiliate.company}</h4>
          <p class="affiliate-description">{affiliate.description}</p>
          
          <ul class="affiliate-highlights">
            {affiliate.highlights.map(highlight => (
              <li>✓ {highlight}</li>
            ))}
          </ul>
          
          <div class="affiliate-cta">
            {affiliate.cta}
            <span class="cta-arrow">→</span>
          </div>
        </a>
      ))}
    </div>
    
    <p class="affiliate-disclaimer">
      <small>
        * We may earn a commission from partner links. This helps us keep CalcCrunch free. 
        Our recommendations are unbiased and based on quality.
      </small>
    </p>
  </div>
)}

<style>
  .affiliate-box {
    margin: var(--space-3xl) 0;
    padding: var(--space-2xl);
    background: linear-gradient(135deg, #FFF8DC 0%, var(--color-white) 100%);
    border-radius: var(--border-radius-lg);
    border: 2px solid var(--color-warning);
  }

  .affiliate-header {
    text-align: center;
    margin-bottom: var(--space-2xl);
  }

  .affiliate-header h3 {
    color: var(--color-primary-blue);
    font-size: var(--text-2xl);
    margin-bottom: var(--space-md);
  }

  .affiliate-header p {
    color: var(--color-gray-dark);
    font-size: var(--text-lg);
  }

  .affiliate-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: var(--space-xl);
    margin-bottom: var(--space-xl);
  }

  .affiliate-card {
    display: flex;
    flex-direction: column;
    background: var(--color-white);
    padding: var(--space-xl);
    border-radius: var(--border-radius-lg);
    text-decoration: none;
    transition: all var(--transition-base);
    box-shadow: var(--shadow-md);
    border: 2px solid var(--color-gray);
    position: relative;
  }

  .affiliate-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-xl);
    border-color: var(--color-accent-orange);
  }

  .affiliate-badge {
    position: absolute;
    top: var(--space-md);
    right: var(--space-md);
    background: var(--color-accent-orange);
    color: var(--color-white);
    padding: var(--space-xs) var(--space-sm);
    border-radius: 6px;
    font-size: var(--text-xs);
    font-weight: 700;
  }

  .affiliate-logo {
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: var(--space-lg);
  }

  .affiliate-logo img {
    max-width: 100%;
    max-height: 40px;
    object-fit: contain;
  }

  .affiliate-card h4 {
    color: var(--color-primary-blue);
    font-size: var(--text-xl);
    margin-bottom: var(--space-md);
    text-align: center;
  }

  .affiliate-description {
    color: var(--color-gray-dark);
    font-size: var(--text-base);
    line-height: 1.6;
    margin-bottom: var(--space-lg);
    flex: 1;
  }

  .affiliate-highlights {
    list-style: none;
    padding: 0;
    margin: 0 0 var(--space-lg) 0;
  }

  .affiliate-highlights li {
    color: var(--color-gray-dark);
    font-size: var(--text-sm);
    margin-bottom: var(--space-xs);
    padding-left: var(--space-sm);
  }

  .affiliate-cta {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: var(--space-sm);
    background: var(--color-accent-orange);
    color: var(--color-white);
    padding: var(--space-md) var(--space-lg);
    border-radius: var(--border-radius);
    font-weight: 700;
    transition: all var(--transition-fast);
  }

  .affiliate-card:hover .affiliate-cta {
    background: var(--color-accent-orange-dark);
  }

  .cta-arrow {
    transition: transform var(--transition-fast);
  }

  .affiliate-card:hover .cta-arrow {
    transform: translateX(4px);
  }

  .affiliate-disclaimer {
    text-align: center;
    color: var(--color-gray-dark);
    opacity: 0.8;
    margin-top: var(--space-xl);
  }

  @media (max-width: 768px) {
    .affiliate-grid {
      grid-template-columns: 1fr;
    }

    .affiliate-box {
      padding: var(--space-lg);
    }
  }
</style>