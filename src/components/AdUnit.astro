---
// AdUnit component for displaying Google AdSense ads
const {
  slot = "auto",
  format = "auto",
  className = "",
  responsive = true,
  test = false,
  style = "display:block",
} = Astro.props;
---

<div class={`ad-unit ${className}`}>
  <div class="ad-label">Advertisement</div>

  <!-- Google AdSense Ad Unit -->
  <ins
    class="adsbygoogle"
    style={style}
    data-ad-client="ca-pub-7168350672318573"
    data-ad-slot={slot}
    data-ad-format={format}
    data-full-width-responsive={responsive}
    data-ad-test={test ? "on" : "off"}></ins>

  <script is:inline>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
  <script is:inline>
    // Ad blocker detection - only run once per page
    if (!window.adBlockDetectionInitialized) {
      window.adBlockDetectionInitialized = true;
      // Check if ads are actually rendered after a delay
      setTimeout(() => {
        const adElements = document.querySelectorAll(".adsbygoogle");
        adElements?.forEach((el) => {
          // Check if the ad element has been filled (has children or height)
          if (el.offsetHeight === 0 || el.childElementCount === 0) {
            if (el.closest(".ad-unit")) {
              el.closest(".ad-unit").style.display = "none";
            }
            // add option to display alternate ads such as amazon affiliate links using custom amazon affiliate component
          }
        });
      }, 500);
    }
  </script>
</div>

<style>
  .ad-unit {
    margin: var(--space-xl) 0;
    padding: var(--space-md);
    background: var(--color-gray-light);
    border-radius: var(--border-radius);
    text-align: center;
  }

  .ad-label {
    font-size: var(--text-xs);
    color: var(--color-gray-dark);
    opacity: 0.6;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: var(--space-sm);
    font-family: var(--font-body);
  }

  .adsbygoogle {
    display: block;
    min-height: 250px;
    background: var(--color-white);
    border-radius: var(--border-radius);
  }

  /* Responsive ad sizes */
  @media (max-width: 768px) {
    .ad-unit {
      margin: var(--space-lg) 0;
      padding: var(--space-sm);
    }

    .adsbygoogle {
      min-height: 200px;
    }
  }

  /* Different ad formats */
  .ad-unit.sidebar {
    position: sticky;
    top: 100px;
  }

  .ad-unit.horizontal .adsbygoogle {
    min-height: 90px;
  }

  .ad-unit.square .adsbygoogle {
    min-height: 300px;
  }

  .ad-unit.rectangle .adsbygoogle {
    min-height: 250px;
  }
</style>
